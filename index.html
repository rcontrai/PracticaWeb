<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Task Editor</title>
    <meta name="Description" content="A school assignment; subject: Programación de Aplicaciones para Dispositivos Móviles; school: Universidad Complutense de Madrid; authors: R.C., R.,G.">
    <meta name="theme-color" content="#D27A64"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="images/favicon.png">
    <link rel="apple-touch-icon" href="images/favicon.png">
    <link rel="manifest" href="manifest.json" crossorigin="use-credentials">
    <link type="text/css" rel="stylesheet" href="style.css">
    <!--
    <script>
      if ('serviceWorker' in navigator) {
          window.addEventListener('load', () => {
              navigator.serviceWorker.register('sw.js').then(reg => {
                  console.log('service worker registered succesfully:', reg)
              }, function (err) {
                  console.log('service worker failed to load:', err)
              })
          })
      }
    </script>
    -->
  </head>
    <form> 
        <input class="firstButton" type="button" value="Añadir tarea">
    </form>
    <dl id="tareaList">
        <dt><input id="btn1" class="tareaButton" type="button" value="tarea 1"></dt>
        <dt><input id="btn2" class="tareaButton" type="button" value="tarea 2"></dt>
        <dt><input id="btn3" class="tareaButton" type="button" value="tarea 3"></dt>
        <dt id="dtID"></dt>
      </dl>
    <!-- The Modal -->
    <div id="myModal" class="modal">

        <!-- Modal content -->
        <div class="modal-content">
            <span class="close">&times;</span>
            <p>Introducir un nombre de tarea :</p>
            <input type="text" class="textInput" id="name" name="name" required
            minlength="0" maxlength="20" size="10">
            <div class="blockButton">
                <input id="btnAccept" class="popUpButton" type="button" value="Guardar">
                <input id="btnCancel" class="popUpButton" type="button" value="Cancelar">
            </div>
        </div>
  
    </div>
</html>


<script type="text/javascript">
var lastId = 3;

var modal = document.getElementById("myModal");
btnAccept.addEventListener('click', addElement);
btnCancel.addEventListener('click', cancel);
btn1.addEventListener('click', updateButton);
btn2.addEventListener('click', updateButton);
btn3.addEventListener('click', updateButton);

function guardar() { //marche que pour le premier button
  var node = document.getElementsByClassName("editButton")[1].parentElement.parentElement;
  //if (node.parentNode) {
  //node.firstChild.value;
  node.firstChild.type = "button";
  //node.firstChild.nextSibling.removeChild();
  //var d = document.getElementById("top");
  var node_nested = document.getElementById("btn1_ol");
  var throwawayNode = node.removeChild(node_nested);

}
function eliminar() { //marche seulement si un seul block est ouvert.
  var node = document.getElementsByClassName("editButton")[1].parentElement.parentElement;
  if (node.parentNode) {
  node.parentNode.removeChild(node);
}

}
function cancelar() { //marche pour le 1
  //console.log(document.getElementsByClassName("editButton")[2].parentElement.parentElement);
  console.log("hey");

  console.log(document.getElementById("btn1_3").parentNode.value);
  console.log(document.getElementById("btn1").value); // = document.getElementById(this.id).nextSibling;

  document.getElementById("btn1").value = document.getElementById("btn1_3").parentNode.value;

  guardar();
}




function updateButton(){
  if(this.type == "button"){
    this.type = "text";
    var newOL = document.createElement("ol");
    newOL.id = this.id + "_ol";
    var newButton1 = document.createElement("button");
    var newContent = document.createTextNode("Guardar");
    newButton1.className = "editButton" ;
    newButton1.id = this.id + "_1";
    newButton1.appendChild(newContent);

    var newButton2 = document.createElement("button");
    var newContent = document.createTextNode("Eliminar");
    newButton2.className = "editButton" ;
    newButton2.id = this.id + "_2";
    newButton2.appendChild(newContent);

    var newButton3 = document.createElement("button");
    var newContent = document.createTextNode("Cancelar");
    newButton3.className = "editButton" ;
    newButton3.id = this.id + "_3";
    newButton3.appendChild(newContent);
    

    newOL.appendChild(newButton1);
    newOL.appendChild(newButton2);
    newOL.appendChild(newButton3);
    var parentDiv = document.getElementById(this.id).parentNode;
    parentDiv.insertBefore(newOL, document.getElementById(this.id).nextSibling);
    document.getElementById(this.id).nextSibling.value = document.getElementById(this.id).parentNode.firstChild.value;
    newButton1.addEventListener('click', guardar);
    newButton2.addEventListener('click', eliminar);
    newButton3.addEventListener('click', cancelar);
  }

}

function cancel() {
  document.getElementById("name").value = null;
  modal.style.display = "none";
}
function addElement () {
  if(document.getElementById("name").value != "") {
    var newDT = document.createElement("dt");
    var newButton = document.createElement("input");
    var newContent = document.createTextNode(document.getElementById("name").value);
    newButton.className = "tareaButton" ;
    lastId ++;
    newButton.id = "btn" + lastId;
    newButton.type = "button";
    newButton.appendChild(newContent);
    newDT.appendChild(newButton);
    var parentDiv = document.getElementById('dtID').parentNode;
    parentDiv.insertBefore(newDT, document.getElementById('dtID'));
    document.getElementById("name").value = null;
    modal.style.display = "none";
    newButton.addEventListener('click', updateButton);

  }
}

document.querySelector('input').onclick = function() {
    modal.style.display = "block";
}
document.getElementsByClassName("close")[0].onclick = function() {
  modal.style.display = "none";
}

window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}
</script>

